
# 유저 생성
```
CREATE USER director@'%' IDENTIFIED BY '1234';
GRANT ALL ON *.* TO director@'%' WITH GRANT OPTION;

CREATE USER ceo@'%' IDENTIFIED BY '1234';
GRANT SELECT ON *.* TO ceo@'%';

CREATE USER staff@'%' IDENTIFIED BY '1234';
GRANT SELECT, INSERT, UPDATE, DELETE ON shopDB.* TO staff@'%';
GRANT SELECT ON employees.* TO staff@'%';

CREATE USER alba@'%' IDENTIFIED BY '1234';
GRANT SELECT On shopDB.uv_membertbl TO alba@'%';
```
# 조회 순서
```
모든 테이베이스 조회하기

SHOW DATABASES;
USE employees;
-- 데이터베이스 내 테이블 간단 이름보기
SHOW TABLES;

-- 데이터베이스 내 테이블 정보 조회하기
SHOW TABLE STATUS;

-- 테이블의 열(=컬럼=필드) 확인하기
DESCRIBE employees;
DESC employees;

-- 확인한 컬럼으로 셀레트문 조회하기
SELECT emp_no, first_name, gender from employees
```

# 테이블 생성 (유저테이블)
```
CREATE TABLE usertbl
( userID	CHAR(8)		NOT NULL PRIMARY KEY, -- 사용자 아이디
  name		VARCHAR(10) NOT NULL,  -- 이름
  birthYear INT 		NOT NULL,  -- 생년
  addr		CHAR(2)		NOT NULL,  -- 주소
  mobile1	CHAR(3),  -- 국번 010
  mobile2	CHAR(8),  -- 국번제외 전화번호
  height	SMALLINT, -- 키
  mDate		DATE      -- 회원가입일
);
```
# 테이블 생성 (구매테이블)
```
CREATE TABLE buytbl
( num    	 INT 	 AUTO_INCREMENT NOT NULL PRIMARY KEY, -- 순번
  userID 	 CHAR(8) NOT NULL,  -- 회원ID
  prodName	 CHAR(6) NOT NULL,  -- 상품명
  groupName  CHAR(4),  -- 분류
  price		 INT NOT NULL,  -- 가격
  amount     SMALLINT NOT NULL,   -- 수량
  FOREIGN KEY (userID) REFERENCES usertbl(userID)
);
```
# 입력 내용
```
INSERT INTO usertbl VALUES('LSG', '이승기', 1987, '서울', '011', '1111111', 182, '2008-8-8');
INSERT INTO usertbl VALUES('KBS', '김범수', 1979, '경남', '011', '2222222', 173, '2012-4-4');
INSERT INTO usertbl VALUES('KKH', '김경호', 1971, '전남', '019', '3333333', 177, '2007-7-7');
INSERT INTO usertbl VALUES('JYP', '조용필', 1950, '경기', '011', '4444444', 166, '2009-4-4');
INSERT INTO usertbl VALUES('SSK', '성시경', 1979, '서울', NULL  , NULL      , 186, '2013-12-12');
INSERT INTO usertbl VALUES('LJB', '임재범', 1963, '서울', '016', '6666666', 182, '2009-9-9');
INSERT INTO usertbl VALUES('YJS', '윤종신', 1969, '경남', NULL  , NULL      , 170, '2005-5-5');
INSERT INTO usertbl VALUES('EJW', '은지원', 1972, '경북', '011', '8888888', 174, '2014-3-3');
INSERT INTO usertbl VALUES('JKW', '조관우', 1965, '경기', '018', '9999999', 172, '2010-10-10');
INSERT INTO usertbl VALUES('BBK', '바비킴', 1973, '서울', '010', '0000000', 176, '2013-5-5');
INSERT INTO buytbl VALUES(NULL, 'KBS', '운동화', NULL   , 30,   2);
INSERT INTO buytbl VALUES(NULL, 'KBS', '노트북', '전자', 1000, 1);
INSERT INTO buytbl VALUES(NULL, 'JYP', '모니터', '전자', 200,  1);
INSERT INTO buytbl VALUES(NULL, 'BBK', '모니터', '전자', 200,  5);
INSERT INTO buytbl VALUES(NULL, 'KBS', '청바지', '의류', 50,   3);
INSERT INTO buytbl VALUES(NULL, 'BBK', '메모리', '전자', 80,  10);
INSERT INTO buytbl VALUES(NULL, 'SSK', '책'    , '서적', 15,   5);
INSERT INTO buytbl VALUES(NULL, 'EJW', '책'    , '서적', 15,   2);
INSERT INTO buytbl VALUES(NULL, 'EJW', '청바지', '의류', 50,   1);
INSERT INTO buytbl VALUES(NULL, 'BBK', '운동화', NULL   , 30,   2);
INSERT INTO buytbl VALUES(NULL, 'EJW', '책'    , '서적', 15,   1);
INSERT INTO buytbl VALUES(NULL, 'BBK', '운동화', NULL   , 30,   2);
```

# 데이터 연산자
```
-- 특정한 조건의 데이터만 조회하기
-- where 절
-- SELECT 컬럼명(필드명) FROM 테이블명 WHERE 조건식;
use sqldb;
```
#
```
SELECT * FROM usertbl WHERE name = '김경호';
SELECT * FROM usertbl where name = '이승기';
-- 주소가 서울인 사람 조회
SELECT * FROM usertbl where addr = '서울';
-- 키가 175 이상인 사람만 조회
SELECT * FROM usertbl where height >= 175;
-- 1970년 이후에 출생한 사람 조회
select * FROM usertbl where birthyear >= 1970;
```
#
```
-- 조건을 2가지 이상 사용 (관계 연산자)
SELECT * FROM usertbl 
WHERE height >= 182 and birthYear >= 1975;
SELECT * FROM usertbl 
WHERE height >= 182 or birthYear >= 1975;
-- BETWEEN ... AND
-- 연속적인 값(Continious)을 가진 숫자 범위 조회
SELECT * FROM usertbl
where height >= 180 and height <= 185;
SELECT * FROM usertbl
where height between 180 AND 185;
-- IN() :
-- 이산적인 값(Discreate)을 가진 문자열 조회
select * from usertbl
where addr = '서울' or addr = '전남' or addr = '경남';
select * from usertbl
where addr IN ('서울','전남','경남');
-- LIKE : 문자열의 내용을 검색 
-- 와일드카드 % (무엇이든 허용), _ (한글자와 매칭)
SELECT * FROM usertbl where name LIKE '김%';
SELECT * FROM usertbl where name LIKE '_범수';
```
#
```
-- 서브쿼리 (subQuery) : 쿼리문 안에 쿼리문이 들어 있는 것
-- 김경호(177)보다 키카 큰 사람을 질의 하고 싶을 때
select * from usertbl where height > name = '김경호'; -- 177
select name, height from usertbl where height > 177; -- 177 wkfldp znjflans

-- 단일행(single row) 서브쿼리
-- 서브쿼리 177보다 키카 큰 사람 결과와 동일
select name, height from usertbl 
where height > (select height from usertbl where name = '김경호');

-- select 컬럼명 from 테이블명
-- where 조건 연산자 (select 컬럼명 from 테이블명 where 조건문);

-- 다중 행 (multi row) 서브쿼리
select name, height from usertbl where addr = '경남';
-- 행이 2개 이상이라 에러 발생 
select name, height from usertbl 
where height > (select height from usertbl where addr = '경남');
-- ANY 구문을 사용하면 170보다 크거나, 173보다 크거나 => 170보다 큰 사람
select name, height from usertbl 
where height > ANY (select height from usertbl where addr = '경남');
-- ALL 구문을 사용하면 170보다 크고, 173보다 큰 사람 => 173보다 큰 사람
select name, height from usertbl
where height > ALL (select height from usertbl where addr = '경남');
```
#
```
-- ORDER BY
-- 순서를 조절하는 구문, 쿼리 결과를 정렬
-- 기본값은 오름차순(ASC), 내림차순(DESC)

-- 가입일 기준 오름차순
SELECT * FROM usertbl ORDER by mDate; -- 기본값 : 오름차순
SELECT * FROM usertbl ORDER by mDate ASC; -- 오름차순
SELECT * FROM usertbl ORDER by mDate DESC; -- 내림차순

-- 기준을 2가지 이상 사용하는 경우
SELECT * FROM usertbl ORDER by addr ASC, height desc;

-- 주의사항 : 데이터베이스의 개수가 많을 경우 성능을 떨어뜨릴 소지가 있음.

-- DISITNCT : 중복 제거하기
select addr from usertbl ORDER BY addr;
select distinct addr from usertbl;
select distinct addr from usertbl ORDER by addr;
```
#
```
-- LIMIT : 출력개수를 제한하기
use  employees;
select * from employees order by hire_data asc;
-- 입사일이 최고 오래된 5명만 조회하고 싶다
-- LIMIT 시작 인덱스, 개수
-- 6~10 까지
select * from employees order by hire_data asc limit 5;
-- 10 ~ 5 까지
select * from employees order by hire_data asc limit 10, 5;
-- 'LIMIT 개수 OFFSET 시작위치' 형식으로 사용 가능
select * from employees order by hire_data asc LIMIT 5 OFFSET 10;
```
#
```
-- 테이블 복사하기
-- create table 새로운테이블명 (select 복사할열 from 복사할테이블)
use sqldb;
-- 전체 열 복사하기
create table buytbl2 (SELECT * FROM buytbl);
select * from buytbl2;
-- 테이블을 복사한 경우 PK, FK 등의 제약조건은 복사 되지 않는다.
desc buytbl;
desc buytbl2;

-- 일부 컬럼만 복제하기
create table buytbl2 (SELECT prodName FROM buytbl);
select * from buytbl3;

-- GROUP BY : 그룹으로 묶는 역할, 집계함수와 같이 사용
select userID, amount from buytbl order by userID;
select userID, sum(amount) from buytbl group by userID;
```
#
```
-- 집계함수 sum(), min(), max(), avg(), count()
-- 평균
SELECT AVG(amount) from buytbl;
SELECT userID, avg(amount) from buytbl group by userID;
```
#
```
SELECT max(height) from usertbl; -- 가장 큰 키 구하기
SELECT name, max(height) from usertbl group by name;
-- 조건절에 서브쿼리를 추가하여 최대값과 사람이름을 구하기
select name, height from usertbl 
where height = (select max(height) from usertbl);
select name, height from usertbl 
where height = (select min(height) from usertbl);
```
#
```
-- COUNT 숫자 세기
select * from usertbl;
-- 전체 회원의 수 : 10
select count(*) from usertbl;
-- 휴대폰 정보가 등록된 회원의 수 : 8 -> null은 count에서 제외
select count(mobile) from usertbl;
```
#
```
-- HAVING : GROUP BY 와 함께 사용하는 조건절
-- group by로 나온 집계함수에 조건 필터링이 가능하다.
-- 사용자별 총구매액(가격*구매양) 구하기
select userID, sum(price*amount) from buybtl group by userID;
select userID, sum(price*amount) from buybtl 
group by userID
HAVING sum(price*amount) > 1000
order by sum(price*amount) desc;
```
#
```
-- 집계함수 기준 정렬 order by 사용 가능
select userID, sum(price*amount) from buybtl 
group by userID
HAVING sum(price*amount) > 1000
order by sum(price*amount) desc;
```